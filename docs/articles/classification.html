<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification Models With stacks • stacks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Classification Models With stacks">
<meta property="og:description" content="stacks">
<meta property="og:image" content="https://stacks.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">stacks</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basics.html">Getting Started With stacks</a>
    </li>
    <li>
      <a href="../articles/classification.html">Classification Models With stacks</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/stacks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="classification_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Classification Models With stacks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/stacks/blob/master/vignettes/classification.Rmd"><code>vignettes/classification.Rmd</code></a></small>
      <div class="hidden name"><code>classification.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we’ll tackle a multiclass classification problem using the stacks package. This vignette assumes that you’re familiar with tidymodels “proper,” as well as the basic grammar of the package, and have seen it implemented on numeric data; if this is not the case, check out the “Getting Started With stacks” vignette!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stacks.tidymodels.org/">stacks</a></span><span class="op">)</span></code></pre></div>
<p>In this example, we’ll make use of the <code>tree_frogs</code> data exported with <code>stacks</code>, giving experimental results on hatching behavior of red-eyed tree frog embryos!</p>
<p>Red-eyed tree frog (RETF) embryos can hatch earlier than their normal 7ish days if they detect potential predator threat. Researchers wanted to determine how, and when, these tree frog embryos were able to detect stimulus from their environment. To do so, they subjected the embryos at varying developmental stages to “predator stimulus” by jiggling the embryos with a blunt probe. Beforehand, though, some of the embryos were treated with gentamicin, a compound that knocks out their lateral line (a sensory organ). Researcher Julie Jung and her crew found that these factors inform whether an embryo hatches prematurely or not!</p>
<p>In this article, we’ll use most all of the variables in <code>tree_frogs</code> to predict <code>reflex</code>, a measure of ear function called the vestibulo-ocular reflex (VOR), categorized into bins. Ear function increases from factor levels “low”, to “mid”, to “full”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"tree_frogs"</span><span class="op">)</span>

<span class="co"># subset the data</span>
<span class="va">tree_frogs</span> <span class="op">&lt;-</span> <span class="va">tree_frogs</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clutch</span>, <span class="va">latency</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s plot the data to get a sense for how separable these groups are.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tree_frogs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">reflex</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Embryo Age (s)"</span>, 
       x <span class="op">=</span> <span class="st">"treatment"</span>,
       color <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>It looks like the embryo age is pretty effective at picking out embryos with full VOR function, but the problem gets tougher for the less developed embryos! Let’s see how well the stacked ensemble can classify these tree frogs.</p>
<div id="defining-candidate-ensemble-members" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-candidate-ensemble-members" class="anchor"></a>Defining candidate ensemble members</h1>
<p>As in the numeric prediction setting, defining the candidate ensemble members is undoubtedly the longest part of the ensembling process with stacks. First, splitting up the training data, generating resamples, and setting some options that will be used by each model definition.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># some setup: resampling and a basic recipe</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">tree_frogs_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">tree_frogs</span><span class="op">)</span>
<span class="va">tree_frogs_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">tree_frogs_split</span><span class="op">)</span>
<span class="va">tree_frogs_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">tree_frogs_split</span><span class="op">)</span>

<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv</a></span><span class="op">(</span><span class="va">tree_frogs_train</span>, v <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="va">tree_frogs_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">reflex</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tree_frogs_train</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">reflex</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">tree_frogs_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">tree_frogs_rec</span><span class="op">)</span></code></pre></div>
<p>We also need to use the same control settings as in the numeric response setting:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control_stack_grid.html">control_stack_grid</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We’ll define two different model definitions to try to predict <code>reflex</code>—a random forest and a neural network.</p>
<p>Starting out with a random forest:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rand_forest_spec</span> <span class="op">&lt;-</span> 
  <span class="fu">rand_forest</span><span class="op">(</span>
    mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,
    min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,
    trees <span class="op">=</span> <span class="fl">500</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span>

<span class="va">rand_forest_wflow</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_wflow</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">rand_forest_spec</span><span class="op">)</span>

<span class="va">rand_forest_res</span> <span class="op">&lt;-</span> 
  <span class="fu">tune_grid</span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">rand_forest_wflow</span>, 
    resamples <span class="op">=</span> <span class="va">folds</span>, 
    grid <span class="op">=</span> <span class="fl">10</span>,
    control <span class="op">=</span> <span class="va">ctrl_grid</span>
  <span class="op">)</span></code></pre></div>
<p>Now, moving on to the neural network model definition:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnet_spec</span> <span class="op">&lt;-</span>
  <span class="fu">mlp</span><span class="op">(</span>hidden_units <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, epochs <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"nnet"</span><span class="op">)</span>

<span class="va">nnet_rec</span> <span class="op">&lt;-</span> 
  <span class="va">tree_frogs_rec</span> <span class="op">%&gt;%</span> 
  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">nnet_wflow</span> <span class="op">&lt;-</span> 
  <span class="va">tree_frogs_wflow</span> <span class="op">%&gt;%</span>
  <span class="fu">add_model</span><span class="op">(</span><span class="va">nnet_spec</span><span class="op">)</span>

<span class="va">nnet_res</span> <span class="op">&lt;-</span>
  <span class="fu">tune_grid</span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">nnet_wflow</span>, 
    resamples <span class="op">=</span> <span class="va">folds</span>, 
    grid <span class="op">=</span> <span class="fl">10</span>,
    control <span class="op">=</span> <span class="va">ctrl_grid</span>
  <span class="op">)</span></code></pre></div>
<p>With these model definitions fully specified, we’re ready to start putting together an ensemble!</p>
</div>
<div id="putting-together-a-stack" class="section level1">
<h1 class="hasAnchor">
<a href="#putting-together-a-stack" class="anchor"></a>Putting together a stack</h1>
<p>Building the stacked ensemble, now, only takes a few lines:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_model_st</span> <span class="op">&lt;-</span> 
  <span class="co"># initialize the stack</span>
  <span class="fu"><a href="../reference/stacks.html">stacks</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># add candidate members</span>
  <span class="fu"><a href="../reference/add_candidates.html">add_candidates</a></span><span class="op">(</span><span class="va">rand_forest_res</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_candidates.html">add_candidates</a></span><span class="op">(</span><span class="va">nnet_res</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># determine how to combine their predictions</span>
  <span class="fu"><a href="../reference/blend_predictions.html">blend_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># fit the candidates with nonzero stacking coefficients</span>
  <span class="fu"><a href="../reference/fit_members.html">fit_members</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">tree_frogs_model_st</span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    member                         type        weight class</span>
<span class="co">#&gt;    &lt;chr&gt;                          &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;</span>
<span class="co">#&gt;  1 .pred_full_nnet_res_1_04       mlp          62.3  low  </span>
<span class="co">#&gt;  2 .pred_mid_rand_forest_res_1_01 rand_forest  44.0  low  </span>
<span class="co">#&gt;  3 .pred_mid_nnet_res_1_04        mlp          28.2  low  </span>
<span class="co">#&gt;  4 .pred_full_nnet_res_1_07       mlp          22.7  low  </span>
<span class="co">#&gt;  5 .pred_mid_rand_forest_res_1_10 rand_forest  22.1  mid  </span>
<span class="co">#&gt;  6 .pred_mid_rand_forest_res_1_05 rand_forest  21.8  mid  </span>
<span class="co">#&gt;  7 .pred_mid_nnet_res_1_08        mlp          21.1  low  </span>
<span class="co">#&gt;  8 .pred_mid_rand_forest_res_1_07 rand_forest  20.1  low  </span>
<span class="co">#&gt;  9 .pred_mid_nnet_res_1_09        mlp          13.1  mid  </span>
<span class="co">#&gt; 10 .pred_mid_rand_forest_res_1_09 rand_forest   9.96 mid</span></code></pre></div>
<p>To make sure that we have the right trade-off between minimizing the number of members and optimizing performance, we can use the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/penalty-plot-1.png" width="768"></p>
<p>To show the relationship more directly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, type <span class="op">=</span> <span class="st">"members"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/members-plot-1.png" width="768"></p>
<p>If these results were not good enough, <code><a href="../reference/blend_predictions.html">blend_predictions()</a></code> could be called again with different values of <code>penalty</code>. As it is, <code><a href="../reference/blend_predictions.html">blend_predictions()</a></code> picks the penalty parameter with the numerically optimal results. To see the top results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, type <span class="op">=</span> <span class="st">"weights"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/weight-plot-1.png" width="768"></p>
<p>There are multiple facets since the ensemble members can have different effects on different classes.</p>
<p>To identify which model configurations were assigned what stacking coefficients, we can make use of the <code><a href="../reference/collect_parameters.html">collect_parameters()</a></code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_parameters.html">collect_parameters</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, <span class="st">"rand_forest_res"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    member                mtry min_n class terms                             coef</span>
<span class="co">#&gt;    &lt;chr&gt;                &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 rand_forest_res_1_01     1    26 low   .pred_mid_rand_forest_res_1_01  44.0  </span>
<span class="co">#&gt;  2 rand_forest_res_1_01     1    26 low   .pred_full_rand_forest_res_1_01  0    </span>
<span class="co">#&gt;  3 rand_forest_res_1_01     1    26 mid   .pred_mid_rand_forest_res_1_01   0    </span>
<span class="co">#&gt;  4 rand_forest_res_1_01     1    26 mid   .pred_full_rand_forest_res_1_01  0    </span>
<span class="co">#&gt;  5 rand_forest_res_1_01     1    26 full  .pred_mid_rand_forest_res_1_01   0    </span>
<span class="co">#&gt;  6 rand_forest_res_1_01     1    26 full  .pred_full_rand_forest_res_1_01  0    </span>
<span class="co">#&gt;  7 rand_forest_res_1_02     2    33 low   .pred_mid_rand_forest_res_1_02   0    </span>
<span class="co">#&gt;  8 rand_forest_res_1_02     2    33 low   .pred_full_rand_forest_res_1_02  0    </span>
<span class="co">#&gt;  9 rand_forest_res_1_02     2    33 mid   .pred_mid_rand_forest_res_1_02   6.34 </span>
<span class="co">#&gt; 10 rand_forest_res_1_02     2    33 mid   .pred_full_rand_forest_res_1_02  0.329</span>
<span class="co">#&gt; # … with 50 more rows</span></code></pre></div>
<p>This object is now ready to predict with new data!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_pred</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_test</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_cols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, <span class="va">.</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Computing the ROC AUC for the model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html">roc_auc</a></span><span class="op">(</span>
  <span class="va">tree_frogs_pred</span>,
  truth <span class="op">=</span> <span class="va">reflex</span>,
  <span class="fu">contains</span><span class="op">(</span><span class="st">".pred_"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Looks like our predictions were pretty strong! How do the stacks predictions perform, though, as compared to the members’ predictions? We can use the <code>members</code> argument to generate predictions from each of the ensemble members.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_pred</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_test</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">reflex</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_cols</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
      <span class="va">tree_frogs_model_st</span>,
      <span class="va">tree_frogs_test</span>,
      type <span class="op">=</span> <span class="st">"class"</span>,
      members <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span>
    <span class="op">)</span>

<span class="va">tree_frogs_pred</span>
<span class="co">#&gt; # A tibble: 303 x 18</span>
<span class="co">#&gt;    reflex .pred_class .pred_class_rand_f… .pred_class_rand_f… .pred_class_rand_…</span>
<span class="co">#&gt;    &lt;fct&gt;  &lt;fct&gt;       &lt;fct&gt;               &lt;fct&gt;               &lt;fct&gt;             </span>
<span class="co">#&gt;  1 full   low         full                full                full              </span>
<span class="co">#&gt;  2 mid    full        low                 mid                 mid               </span>
<span class="co">#&gt;  3 mid    full        mid                 mid                 mid               </span>
<span class="co">#&gt;  4 mid    full        low                 low                 low               </span>
<span class="co">#&gt;  5 full   low         full                full                full              </span>
<span class="co">#&gt;  6 full   low         full                full                full              </span>
<span class="co">#&gt;  7 full   low         full                full                full              </span>
<span class="co">#&gt;  8 full   low         full                full                full              </span>
<span class="co">#&gt;  9 full   low         full                full                full              </span>
<span class="co">#&gt; 10 full   low         full                full                full              </span>
<span class="co">#&gt; # … with 293 more rows, and 13 more variables:</span>
<span class="co">#&gt; #   .pred_class_rand_forest_res_1_05 &lt;fct&gt;, .pred_class_nnet_res_1_04 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_nnet_res_1_08 &lt;fct&gt;, .pred_class_nnet_res_1_03 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_nnet_res_1_10 &lt;fct&gt;, .pred_class_nnet_res_1_07 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_nnet_res_1_05 &lt;fct&gt;, .pred_class_rand_forest_res_1_10 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_rand_forest_res_1_02 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_rand_forest_res_1_09 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_rand_forest_res_1_06 &lt;fct&gt;,</span>
<span class="co">#&gt; #   .pred_class_rand_forest_res_1_08 &lt;fct&gt;, .pred_class_nnet_res_1_09 &lt;fct&gt;</span>

<span class="fu">map_dfr</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">$</span><span class="va">reflex</span> <span class="op">==</span> <span class="fu">pull</span><span class="op">(</span><span class="va">tree_frogs_pred</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">reflex</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 17 x 3</span>
<span class="co">#&gt;    reflex name                             value</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt;</span>
<span class="co">#&gt;  1      1 .pred_class                      0    </span>
<span class="co">#&gt;  2      1 .pred_class_rand_forest_res_1_01 0.845</span>
<span class="co">#&gt;  3      1 .pred_class_rand_forest_res_1_04 0.871</span>
<span class="co">#&gt;  4      1 .pred_class_rand_forest_res_1_07 0.865</span>
<span class="co">#&gt;  5      1 .pred_class_rand_forest_res_1_05 0.845</span>
<span class="co">#&gt;  6      1 .pred_class_nnet_res_1_04        0.558</span>
<span class="co">#&gt;  7      1 .pred_class_nnet_res_1_08        0.558</span>
<span class="co">#&gt;  8      1 .pred_class_nnet_res_1_03        0.558</span>
<span class="co">#&gt;  9      1 .pred_class_nnet_res_1_10        0.558</span>
<span class="co">#&gt; 10      1 .pred_class_nnet_res_1_07        0.838</span>
<span class="co">#&gt; 11      1 .pred_class_nnet_res_1_05        0.558</span>
<span class="co">#&gt; 12      1 .pred_class_rand_forest_res_1_10 0.871</span>
<span class="co">#&gt; 13      1 .pred_class_rand_forest_res_1_02 0.875</span>
<span class="co">#&gt; 14      1 .pred_class_rand_forest_res_1_09 0.881</span>
<span class="co">#&gt; 15      1 .pred_class_rand_forest_res_1_06 0.871</span>
<span class="co">#&gt; 16      1 .pred_class_rand_forest_res_1_08 0.881</span>
<span class="co">#&gt; 17      1 .pred_class_nnet_res_1_09        0.845</span></code></pre></div>
<p>Voilà! You’ve now made use of the stacks package to predict tree frog embryo ear function using a stacked ensemble!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>stacks is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Simon Couch, Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
