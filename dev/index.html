<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Model Stacking • stacks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Tidy Model Stacking">
<meta property="og:description" content="Model stacking is an ensemble technique
    that involves training a model to combine the outputs of many 
    diverse statistical models, and has been shown to improve 
    predictive performance in a variety of settings. stacks 
    implements a grammar for tidymodels-aligned model stacking.">
<meta property="og:image" content="https://stacks.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="index.html">stacks</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/basics.html">Getting Started With stacks</a>
    </li>
    <li>
      <a href="articles/classification.html">Classification Models With stacks</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/stacks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="stacks---tidy-model-stacking-" class="section level2">
<h2 class="hasAnchor">
<a href="#stacks---tidy-model-stacking-" class="anchor"></a>stacks - tidy model stacking <a href="https://stacks.tidymodels.org"><img src="reference/figures/logo.png" align="right" height="280"></a>
</h2>
<p>stacks is an R package for model stacking that aligns with the tidymodels. Model stacking is an ensembling method that takes the outputs of many models and combines them to generate a new model—referred to as an <em>ensemble</em> in this package—that generates predictions informed by each of its <em>members</em>.</p>
<p>The process goes something like this:</p>
<ol style="list-style-type: decimal">
<li>Define candidate ensemble members using functionality from <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a>, <a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a>, <a href="https://workflows.tidymodels.org/" class="external-link">workflows</a>, <a href="https://recipes.tidymodels.org/" class="external-link">recipes</a>, and <a href="https://tune.tidymodels.org/" class="external-link">tune</a>
</li>
<li>Initialize a <code>data_stack</code> object with <code><a href="reference/stacks.html">stacks()</a></code><br>
</li>
<li>Iteratively add candidate ensemble members to the <code>data_stack</code> with <code><a href="reference/add_candidates.html">add_candidates()</a></code><br>
</li>
<li>Evaluate how to combine their predictions with <code><a href="reference/blend_predictions.html">blend_predictions()</a></code><br>
</li>
<li>Fit candidate ensemble members with non-zero stacking coefficients with <code><a href="reference/fit_members.html">fit_members()</a></code><br>
</li>
<li>Predict on new data with <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>
</li>
</ol>
<p>You can install the package with the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"stacks"</span><span class="op">)</span></code></pre></div>
<p>Install the development version with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"tidymodels/stacks"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></code></pre></div>
<p>stacks is generalized with respect to:</p>
<ul>
<li>Model type: Any model type implemented in <a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a> or adjacent packages is fair game to add to a stacks model stack. <a href="https://www.tidymodels.org/find/parsnip/" class="external-link">Here</a>’s a table of many of the implemented model types in the tidymodels core, with a link there to an article about implementing your own model classes as well.</li>
<li>Cross-validation scheme: Any resampling algorithm implemented in <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a> or adjacent packages is fair game for resampling data for use in training a model stack.</li>
<li>Error metric: Any metric function implemented in <a href="https://yardstick.tidymodels.org/" class="external-link">yardstick</a> or adjacent packages is fair game for evaluating model stacks and their members. That package provides some infrastructure for creating your own metric functions as well!</li>
</ul>
<p>stacks uses a regularized linear model to combine predictions from ensemble members, though this model type is only one of many possible learning algorithms that could be used to fit a stacked ensemble model. For implementations of additional ensemble learning algorithms, check out <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-r/docs/reference/h2o.stackedEnsemble.html" class="external-link">h2o</a> and <a href="https://cran.r-project.org/web/packages/SuperLearner/SuperLearner.pdf" class="external-link">SuperLearner</a>.</p>
<p>Rather than diving right into the implementation, we’ll focus here on how the pieces fit together, conceptually, in building an ensemble with <code>stacks</code>. See the <code>basics</code> vignette for an example of the API in action!</p>
</div>
<div id="a-grammar" class="section level2">
<h2 class="hasAnchor">
<a href="#a-grammar" class="anchor"></a>a grammar</h2>
<p>At the highest level, ensembles are formed from <em>model definitions</em>. In this package, model definitions are an instance of a minimal <a href="https://workflows.tidymodels.org/" class="external-link">workflow</a>, containing a <em>model specification</em> (as defined in the <a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a> package) and, optionally, a <em>preprocessor</em> (as defined in the <a href="https://recipes.tidymodels.org/" class="external-link">recipes</a> package). Model definitions specify the form of candidate ensemble members.</p>
<p><img src="reference/figures/model_defs.png"></p>
<p>To be used in the same ensemble, each of these model definitions must share the same <em>resample</em>. This <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a> <code>rset</code> object, when paired with the model definitions, can be used to generate the tuning/fitting results objects for the candidate <em>ensemble members</em> with tune.</p>
<p><img src="reference/figures/candidates.png"></p>
<p>Candidate members first come together in a <code>data_stack</code> object through the <code><a href="reference/add_candidates.html">add_candidates()</a></code> function. Principally, these objects are just <a href="https://tibble.tidyverse.org/" class="external-link">tibble</a>s, where the first column gives the true outcome in the assessment set (the portion of the training set used for model validation), and the remaining columns give the predictions from each candidate ensemble member. (When the outcome is numeric, there’s only one column per candidate ensemble member. Classification requires as many columns per candidate as there are levels in the outcome variable.) They also bring along a few extra attributes to keep track of model definitions.</p>
<p><img src="reference/figures/data_stack.png"></p>
<p>Then, the data stack can be evaluated using <code><a href="reference/blend_predictions.html">blend_predictions()</a></code> to determine to how best to combine the outputs from each of the candidate members. In the stacking literature, this process is commonly called <em>metalearning</em>.</p>
<p>The outputs of each member are likely highly correlated. Thus, depending on the degree of regularization you choose, the coefficients for the inputs of (possibly) many of the members will zero out—their predictions will have no influence on the final output, and those terms will thus be thrown out.</p>
<p><img src="reference/figures/coefs.png"></p>
<p>These stacking coefficients determine which candidate ensemble members will become ensemble members. Candidates with non-zero stacking coefficients are then fitted on the whole training set, altogether making up a <code>model_stack</code> object.</p>
<p><img src="reference/figures/class_model_stack.png"></p>
<p>This model stack object, outputted from <code><a href="reference/fit_members.html">fit_members()</a></code>, is ready to predict on new data! The trained ensemble members are often referred to as <em>base models</em> in the stacking literature.</p>
<p>The full visual outline for these steps can be found <a href="https://github.com/tidymodels/stacks/blob/main/inst/figs/outline.png" class="external-link">here</a>. The API for the package closely mirrors these ideas. See the <code>basics</code> vignette for an example of how this grammar is implemented!</p>
</div>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>contributing</h2>
<p>This project is released with a <a href="https://github.com/tidymodels/stacks/blob/main/CODE_OF_CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
<ul>
<li><p>For questions and discussions about tidymodels packages, modeling, and machine learning, please <a href="https://community.rstudio.com/new-topic?category_id=15&amp;tags=tidymodels,question" class="external-link">post on RStudio Community</a>.</p></li>
<li><p>If you think you have encountered a bug, please <a href="https://github.com/tidymodels/stacks/issues" class="external-link">submit an issue</a>.</p></li>
<li><p>Either way, learn how to create and share a <a href="https://reprex.tidyverse.org/articles/articles/learn-reprex.html" class="external-link">reprex</a> (a minimal, reproducible example), to clearly communicate about your code.</p></li>
<li><p>Check out further details on <a href="https://www.tidymodels.org/contribute/" class="external-link">contributing guidelines for tidymodels packages</a> and <a href="https://www.tidymodels.org/help/" class="external-link">how to get help</a>.</p></li>
</ul>
<p>In the stacks package, some test objects take too long to build with every commit. If your contribution changes the structure of <code>data_stack</code> or <code>model_stacks</code> objects, please regenerate these test objects by running the scripts in <code>man-roxygen/example_models.Rmd</code>, including those with chunk options <code>eval = FALSE</code>.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=stacks">https://​cloud.r-project.org/​package=stacks</a>
</li>
<li>Browse source code at <br><a href="https://github.com/tidymodels/stacks/">https://​github.com/​tidymodels/​stacks/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/tidymodels/stacks/issues">https://​github.com/​tidymodels/​stacks/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Simon Couch <br><small class="roles"> Author, maintainer </small>  </li>
<li>Max Kuhn <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More on authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/tidymodels/stacks/actions" class="external-link"><img src="https://github.com/simonpcouch/stacks/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/tidymodels/stacks?branch=main" class="external-link"><img src="https://codecov.io/gh/tidymodels/stacks/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://CRAN.R-project.org/package=stacks" class="external-link"><img src="https://www.r-pkg.org/badges/version/stacks" alt="CRAN status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="tidyverse">
  <p>stacks is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Simon Couch, Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
